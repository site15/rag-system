# Frontend документация (React Admin)

## Общее описание

Фронтенд построен на React Admin, предоставляя комплексную панель администрирования для RAG-системы. Он автоматически интегрируется с backend API через сгенерированный код из Prisma DTO генератора.

## Архитектура

### Основные компоненты

#### 1. Главное приложение (`App.tsx`)
```typescript
import { Admin, Resource } from "react-admin";
import { appAuthProvider } from "./AppAuthProvider";
import { appDataProvider } from "./AppDataProvider";
import { CustomLoginPage } from "./forms/CustomLoginPage";
import { client } from "./generated/client/client.gen";
import { resources } from "./generated/resource/resources";

client.setConfig({
  baseUrl: import.meta.env.VITE_API_URL,
  headers: { "x-api-key": authService.getApiKey() },
});

export const App = () => {
  const resourceNames = Object.keys(resources);
  
  return (
    <Admin
      requireAuth
      loginPage={CustomLoginPage}
      authProvider={appAuthProvider}
      dataProvider={appDataProvider}
    >
      {resourceNames.map((resourceName, index) => (
        <Resource
          key={index}
          name={resourceName}
          options={{ label: resources[resourceName]?.label }}
          list={resources[resourceName]?.list}
          show={resources[resourceName]?.show}
          create={resources[resourceName]?.create}
          edit={resources[resourceName]?.edit}
        />
      ))}
    </Admin>
  );
};
```

#### 2. Провайдер аутентификации (`AppAuthProvider.ts`)
Обрабатывает аутентификацию пользователей и управление сессиями:
- Функциональность входа/выхода
- Управление API ключами
- Валидация сессий
- Проверка прав доступа

#### 3. Провайдер данных (`AppDataProvider.ts`)
Центральный уровень маршрутизации, который делегирует запросы специфичным провайдерам данных:
- Маршрутизация запросов к соответствующим сгенерированным провайдерам данных
- Обработка глобальных ошибок
- Управление обновлением токенов аутентификации
- Реализация логики повторных попыток

## Сгенерированные ресурсы

Система автоматически генерирует полные CRUD интерфейсы для всех моделей Prisma:

### Структура ресурсов
Для каждой модели генерируется:
- **DataProvider**: Реализует все операции данных React Admin
- **Формы**: Формы создания/редактирования/просмотра с соответствующими компонентами ввода
- **Просмотр списков**: Поисковые и сортируемые списки
- **Определения типов**: Полная поддержка TypeScript

### Доступные ресурсы

#### Ресурсы аутентификации
- `AuthUser` - Управление пользователями
- `AuthApiKey` - Управление API ключами
- `AuthSession` - Отслеживание сессий

#### Ресурсы чата
- `ChatDialog` - Диалоги разговоров
- `ChatMessage` - Отдельные сообщения с богатым содержимым
- `ChatDocumentEmbedding` - Эмбеддинги документов с векторными данными
- `ChatMessageDocumentEmbedding` - Отношения сообщение-документ
- `ChatLlmModel` - Конфигурации моделей LLM
- `ChatEmbeddingModel` - Конфигурации моделей эмбеддингов
- `ChatLlmRequest` - Отслеживание запросов LLM
- `ChatPrompt` - Шаблоны промптов

## Автогенерируемые компоненты

### 1. Провайдеры данных
Каждый ресурс получает полный провайдер данных, реализующий:
```typescript
{
  getList: (resource, params) => Promise<GetListResult>,
  getOne: (resource, params) => Promise<GetOneResult>,
  getMany: (resource, params) => Promise<GetManyResult>,
  getManyReference: (resource, params) => Promise<GetManyReferenceResult>,
  create: (resource, params) => Promise<CreateResult>,
  update: (resource, params) => Promise<UpdateResult>,
  updateMany: (resource, params) => Promise<UpdateManyResult>,
  delete: (resource, params) => Promise<DeleteResult>,
  deleteMany: (resource, params) => Promise<DeleteManyResult>
}
```

### 2. Компоненты форм
Автогенерируемые формы с:
- **Формы создания**: Поля для ввода обязательных данных
- **Формы редактирования**: Поля для обновления существующих записей
- **Формы просмотра**: Только чтение всех полей
- Интеллектуальный выбор компонентов ввода на основе типов полей:
  - `TextInput` для строк
  - `NumberInput` для числовых полей
  - `BooleanInput` для булевых значений
  - `DateTimeInput` для временных меток
  - `JsonViewerField` для сложных JSON данных

### 3. Компоненты списков
Поисковые и сортируемые списки с:
- Фильтрация по колонкам
- Поддержка пагинации
- Массовые действия
- Адаптивный дизайн

## Возможности интеграции

### Интеграция клиентского API
Использует сгенерированный OpenAPI клиент:
- Типобезопасные вызовы API
- Автоматическая валидация запросов/ответов
- Встроенная обработка ошибок
- Внедрение заголовков аутентификации

### Поток аутентификации
1. Пользователь входит через пользовательскую страницу входа
2. API ключ безопасно сохраняется
3. Все запросы включают заголовки аутентификации
4. Автоматический выход при ошибках аутентификации

### Обработка ошибок
- Глобальная перехватка ошибок
- Автоматическое обновление сессии
- Понятные сообщения об ошибках
- Грациозная деградация

## Точки кастомизации

### Пользовательские формы
Расположены в директории `src/forms/`:
- `CustomLoginPage.tsx` - Пользовательский интерфейс аутентификации
- Расширяемо для дополнительных пользовательских форм

### Стилизация
- Использует компоненты Material-UI
- Кастомизация тем через систему тем React Admin
- Адаптивный дизайн для всех размеров экранов

### Расширения
- Можно добавить пользовательские компоненты полей
- Можно интегрировать дополнительные провайдеры данных
- Поддерживаются пользовательские действия и кнопки

## Рабочий процесс разработки

### Добавление новых ресурсов
1. Определить модель в схеме Prisma
2. Запустить `npx prisma generate` для регенерации DTO
3. Запустить сборку фронтенда для регенерации компонентов React Admin
4. Новый ресурс автоматически появляется в панели администратора

### Пользовательские типы полей
Для специальных типов данных, таких как векторы или эмбеддинги:
1. Создать пользовательский компонент ввода
2. Зарегистрировать в шаблонах генерации форм
3. Добавить в сопоставление типов полей

## Оптимизации производительности

### Разделение кода
- Ленивая загрузка компонентов ресурсов
- Разделение бандла по типам ресурсов
- Динамические импорты для крупных компонентов

### Кэширование
- Клиентское кэширование часто запрашиваемых данных
- Дедупликация запросов
- Паттерны stale-while-revalidate

### Размер бандла
- Tree-shaking неиспользуемых компонентов
- Селективные импорты из Material-UI
- Минификация и сжатие

## Функции безопасности

### Аутентификация
- Аутентификация на основе API ключей
- Безопасное хранение токенов
- Обработка таймаута сессии
- Защита от CSRF

### Авторизация
- Контроль доступа на основе ролей
- Права доступа на уровне ресурсов
- Контроль видимости на уровне полей

### Защита данных
- Санитизация ввода
- Предотвращение XSS
- Безопасная коммуникация API
- Логирование аудита

## Деплой

### Процесс сборки
```bash
npm run build
```
Создает оптимизированный production бандл в директории `dist/`.

### Конфигурация окружения
- `VITE_API_URL` - Endpoint backend API
- Настройки аутентификации
- Флаги функций

### Варианты хостинга
- Статический хостинг (Netlify, Vercel)
- Традиционные веб-серверы
- Деплой контейнеров

## Мониторинг и аналитика

### Логирование
- Логирование запросов/ответов
- Отслеживание ошибок
- Метрики производительности
- Мониторинг активности пользователей

### Отладка
- Режим разработки с подробным логированием
- Инструменты инспекции компонентов
- Мониторинг сетевых запросов
- Утилиты отладки состояния

Эта frontend система предоставляет полный, типобезопасный интерфейс администрирования, который автоматически адаптируется к изменениям backend схемы через интеграцию Prisma генератора.