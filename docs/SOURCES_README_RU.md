# Sources документация

## Общее описание

Директория `sources` содержит все исходные документы, которые используются системой RAG для обучения и поиска. Это основной источник знаний для генерации контекстуальных ответов.

## Структура директории

```
sources/
├── articles/           # Статьи и публикации
│   ├── devto/         # Статьи с Dev.to
│   └── habr/          # Статьи с Habr
├── portfolio/          # Портфолио проектов
├── resume/            # Резюме и профили
└── telegram/          # Сообщения Telegram
    └── [множество файлов]
```

## Типы источников

### 1. Articles (Статьи)
Содержит технические статьи и публикации:
- **Dev.to** - статьи с платформы Dev.to (87 файлов)
- **Habr** - статьи с платформы Habr (28 файлов)

Форматы: `.md`, `.txt`

### 2. Portfolio (Портфолио)
Документация по проектам:
- Site15 домашняя страница
- Проекты с GitHub
- Технические описания

Форматы: `.md`, `.html`

### 3. Resume (Резюме)
Профessional информация:
- DeepSeek резюме
- Профессиональные профили

Форматы: `.md`

### 4. Telegram (Сообщения)
Сообщения из Telegram (262 файла):
- Чаты и беседы
- Технические обсуждения
- Заметки и мысли

Форматы: `.txt`, `.md`

## Форматы файлов

### Markdown (.md)
```markdown
## Заголовок статьи

Содержание статьи с форматированием.

### Подзаголовок

Текст с **выделением** и `кодом`.

-- 

Новый раздел документа.
```

### Plain Text (.txt)
```
Простой текстовый формат
Без специального форматирования
Разделение разделов через -- 
```

## Обработка документов

### Иерархическое разделение
Система использует интеллектуальную стратегию разделения:

1. **Первичный уровень**: `\n--\n` - разделение на смысловые блоки
2. **Вторичный уровень**: двойные переносы строк - параграфы  
3. **Третичный уровень**: одинарные переносы строк - предложения
4. **Резервная стратегия**: по словам для оптимальных размеров

### Метаданные
Каждый документ получает метаданные:
```json
{
  "source": "sources/articles/devto/article.md",
  "type": "article",
  "platform": "devto",
  "created_at": "2024-01-15",
  "tags": ["typescript", "nestjs"]
}
```

## Конфигурация обработки

### Переменные окружения
```env
SOURCES_PATH=./sources
PROCESS_DOCUMENTS=true
MAX_CHUNK_SIZE=1600
CHUNK_OVERLAP=200
```

### Фильтрация источников
```typescript
// Глобальный режим (исключение Telegram)
filterBySource: '%/telegram/%'
filterBySourceRule: 'not ilike'

// Telegram режим (только Telegram)
filterBySource: '%/telegram/%'
filterBySourceRule: 'ilike'
```

## Добавление новых источников

### 1. Создание структуры
```bash
mkdir -p sources/new-category/sub-category
```

### 2. Добавление документов
```bash
# Markdown файлы
echo "# Новый документ" > sources/new-category/document.md

# Текстовые файлы
echo "Содержание документа" > sources/new-category/document.txt
```

### 3. Обработка новых документов
```bash
# Запуск обработки
PROCESS_DOCUMENTS=true npm run start:dev

# Или через API
curl -X POST http://localhost:3000/api/documents/process
```

## Лучшие практики

### Форматирование документов
```
## Заголовок

Краткое описание документа.

--

### Основной контент

Подробное содержание с разделением на логические блоки.

Используйте -- для разделения крупных секций.
Используйте пустые строки для разделения абзацев.

### Примеры кода

```typescript
const example = "code";
```

--

### Заключение

Итоговая информация.
```

### Именование файлов
- Используйте понятные, описательные имена
- Избегайте специальных символов
- Используйте kebab-case или snake_case
- Добавляйте даты для версионирования: `document-2024-01-15.md`

### Организация по категориям
```
sources/
├── tutorials/          # Обучающие материалы
├── documentation/      # Техническая документация
├── research/           # Исследования и аналитика
├── notes/              # Заметки и черновики
└── conversations/      # Диалоги и обсуждения
```

## Мониторинг и обслуживание

### Статистика источников
```bash
# Подсчет файлов по категориям
find sources -name "*.md" | wc -l
find sources -name "*.txt" | wc -l

# Размеры директорий
du -sh sources/*
```

### Проверка качества
```bash
# Поиск пустых файлов
find sources -empty

# Поиск файлов без расширения
find sources -type f ! -name "*.*"

# Проверка кодировки
file sources/*/*
```

### Регулярное обслуживание
- Удаление дубликатов
- Архивирование старых документов
- Обновление устаревшей информации
- Оптимизация структуры директорий

## Интеграция с системой

### Автоматическая обработка
Система автоматически отслеживает изменения в директории sources и обрабатывает новые документы при запуске с `PROCESS_DOCUMENTS=true`.

### API для управления
```bash
# Получение списка источников
GET /api/documents/sources

# Обработка конкретного источника
POST /api/documents/process
{
  "sourcePath": "sources/articles/devto"
}

# Обновление метаданных
PUT /api/documents/metadata
{
  "documentId": "uuid",
  "metadata": { "tags": ["new", "tag"] }
}
```

## Безопасность

### Защита конфиденциальной информации
- Не храните пароли и API ключи
- Используйте плейсхолдеры для чувствительных данных
- Регулярно проверяйте содержимое перед коммитом

### Контроль доступа
```bash
# Установка прав доступа
chmod 644 sources/*/*
chmod 755 sources/*/

# Владелец файлов
chown -R user:group sources/
```

Эта документация охватывает все аспекты работы с источниками документов в RAG-системе и помогает эффективно управлять знаниями системы.